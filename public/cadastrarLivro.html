<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="./css/cadastroLivros.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Cadastrar Livros</title>
</head>

<body>

    <head>
        <nav>
            <a href="/public/cadastro.html">Cadastrar Usuario</a>
            <a href="/public/login.html">Login</a>
        </nav>
    </head>
    <main>
        <div class="container">
            <div class="conteudo-principal">
                <div class="optCadastroLivro">
                    <h1>Cadastre o seu livro!</h1>
                    <div class="conteudo_livro">
                        Digite o nome do autor: <input type="text" id="ipt_nomeAutor">
                        Nome do livro: <input type="text" id="ipt_nomeLivro">
                    </div>
                    <select name="genero" id="ipt_genero">
                        <option value="#"></option>
                        <option value="horror">Horror</option>
                        <option value="romance">Romance</option>
                        <option value="poesia">Poesia</option>
                        <option value="fantasia">Fantasia</option>
                    </select>

                </div>
                <div class="conteudo_estoque">

                    Preço de venda: <input type="number" placeholder="Preco de Venda" id="ipt_precoVenda">
                    Preço de compra: <input type="number" placeholder="Preco de Compra" id="ipt_precoCompra">
                    Quantidade em estoque: <input type="number" placeholder="Quantidade em estoque" id="ipt_qtdEstoque">
                </div>
                <button onclick="cadLivro()">Cadastrar Livro</button>
                <div id="outputSucesso"></div>
            </div>
        </div>
    </main>

</body>

</html>
<script>
    function cadLivro() {

        var nomeAutor = ipt_nomeAutor.value;
        var nomeLivro = ipt_nomeLivro.value;
        var precoVenda = Number(ipt_precoVenda.value);
        var precoCompra = Number(ipt_precoCompra.value);
        var qtdEstoque = Number(ipt_qtdEstoque.value);
        var genero = ipt_genero.value;

        var nomeAutorContemNumero = true;
        var nomeLivroContemNumero = true;

        

        for (i = 0; i < nomeAutor.length; i++) {
            if (nomeAutor[i] >= 0) {
                nomeAutorContemNumero = true;
            break;    
            }
            else {
                
                nomeAutorContemNumero = false;
            }
        }

        for (i = 0; i < nomeLivro.length; i++) {
            if (nomeLivro[i] >= 0) {
                nomeLivroContemNumero = true;
                break;   
            }
            
            else {
                nomeLivroContemNumero = false;
            }
        }

        if (nomeAutorContemNumero === true) {
            alert('O nome do autor não pode conter números!')
            return;
        } else if (nomeAutorContemNumero === false) {
            outputSucesso.innerHTML = 'Nome Autor ✅';

        }
        if (nomeLivroContemNumero === true) {
            alert('O nome do livro não pode conter números!')
            return;
        } else if (nomeLivroContemNumero === false) {


            outputSucesso.innerHTML += `<br> Nome Livro ✅<br>`;
        }

        if (qtdEstoque < 0) {
            alert('Informe um valor positívo de estoque deste produto!')
            return;
        }


        if (genero == 'horror' || genero == 'romance' && precoCompra > 100) {
            precoVenda = precoCompra * 1.225
            outputSucesso.innerHTML += `Preço de venda do produto : ${precoVenda}✅<br>`
            outputSucesso.innerHTML += `Preco de compra do produto : ${precoCompra}✅`
        }

        else if (genero == 'poesia' || genero == 'horror' && precoCompra <= 50) {
            precoVenda = precoCompra * 1.25
            outputSucesso.innerHTML += `Preço de venda do produto : ${precoVenda}✅<br>`
            outputSucesso.innerHTML += `Preco de compra do produto : ${precoCompra}✅`

        }
        else if (precoCompra > 50 && precoCompra <= 100 && genero == 'fantasia') {
            precoVenda = precoCompra * 1.275
            outputSucesso.innerHTML += `Preço de venda do produto : ${precoVenda}✅<br>`
            outputSucesso.innerHTML += `Preco de compra do produto : ${precoCompra}✅`

        } else {
            outputSucesso.innerHTML += `Preço de venda do produto : ${precoVenda}✅<br>`
            outputSucesso.innerHTML += `<br>Preco de compra do produto : ${precoCompra}✅`
        }
        




        fetch("/cadastrarLivro", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeAutor: nomeAutor,
                nomeLivro: nomeLivro,
                precoVenda: precoVenda,
                precoCompra: precoCompra,
                qtdEstoque: qtdEstoque,
                genero: genero

            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    console.log("Livro cadastrado com sucesso pelo front, requisição enviada ao back", resposta)
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro deste livro ", resposta;
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);

            });

        return false;
    }














</script>